<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Home - App-Enhance</title>
      
      
      
        <link rel="canonical" href="https://app-enhance.github.io/dependency-injection/">
      
      
        <meta name="author" content="Wojciech GadziÅ„ski">
      
    
    <meta property="og:url" content="https://app-enhance.github.io/dependency-injection/">
    <meta property="og:title" content="App-Enhance">
    <meta property="og:image" content="https://app-enhance.github.io/dependency-injection//../images/logo2.jpg">
    <meta name="apple-mobile-web-app-title" content="App-Enhance">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../images/logo2.jpg">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../None">
    <link rel="icon" type="image/x-icon" href="../None">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-0dac3e5884.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-teal palette-accent-blue-grey">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Dependency injection <i class="icon icon-link"></i>
              
            
          </span>
        
        Home
      </div>
    </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/ermesx" title="@ermesx on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/app-enhance/ae-docs" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../images/logo2.jpg">
        </div>
      
      <div class="name">
        <strong>
          App-Enhance
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          app-enhance/ae-docs
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/app-enhance/ae-docs/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/app-enhance/ae-docs/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Dependency injection</span>
    <ul>
      
        
  <li>
    <a class="current" title="Home" href="./">
      Home
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Motivation" href="#motivation">
                Motivation
              </a>
            </li>
          
            <li class="anchor">
              <a title="Integrations" href="#integrations">
                Integrations
              </a>
            </li>
          
            <li class="anchor">
              <a title="Contribute" href="#contribute">
                Contribute
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
            
              
              <li>
                <a href="https://github.com/ermesx" target="_blank" title="@ermesx on GitHub">
                  @ermesx on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="aeextensionsdependencyinjection">AE.Extensions.DependencyInjection<a class="headerlink" href="#aeextensionsdependencyinjection" title="Permanent link">#</a></h1>
<p>This is an extension library for <code>Microsoft.Extensions.DependencyInjection</code> which provides you with a declarative way to pick out lifetime of services and register them in just a few lines.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">#</a></h2>
<p>When you want to register a service (create dependency) in <code>IServiceCollection</code> you have to describe at least 3 things.</p>
<ul>
<li>Service interface</li>
<li>Service implementation</li>
<li>Lifetime scope</li>
</ul>
<p>Ususally it should look like this (see below)</p>
<p>```c#
// Method ex. in Startup.cs
// doc: http://docs.asp.net/en/latest/fundamentals/dependency-injection.html</p>
<p>public void ConfigureServices(IServiceCollection services)
{
    var serviceDescriptor = new ServiceDescriptor(typeof(IBankManager), typeof(BankManager), ServiceLifetime.Transient);
    services.Add(serviceDescriptor);
    // or 
    services.AddTransient<IBankManager, BankManager>();</p>
<div class="code"><pre><span></span>// Add MVC services to the services container.
services.AddMvc();
</pre></div>


<p>}</p>
<div class="code"><pre><span></span>```c#
/// And service definition somewhere, deeper in the code
public interface IBankManager
{
    int OpenAccount(string clientName);
}

public class BankManager : IBankManager
{
    public int OpenAccount(string clientName)
    {
        // Account creating process...

        return Random.Next(1000000, 9999999);
    }
}
</pre></div>


<p>Every service must be described in <code>ConfigureServices</code> method manualy which means that something can be easily missed.
Many people who create libraries like MVC they add static extension methods to simplify registration. 
It means all descriptions of their services are hidden. 
They make our life easier but what about our own custom services ? What if you have dozens of them ?</p>
<p>I'm inspired by how Orchard team resolves that issue. 
They created interfaces which correspond to lifetime scopes. So every service interface inherits appropriate "scope interface" and describes dependencies to register in global container.
In my case it looks like below - interfaces correspond exactly to <code>ServiceLifetime</code> enum.</p>
<p>```c#
// You can use it to get all dependencies
public interface IDependency
{
}</p>
<p>public interface ISingletonDependency : IDependency
{
}</p>
<p>public interface IScopedDependency : IDependency
{
}</p>
<p>public interface ITransientDependency : IDependency
{
}</p>
<p>// Omit registration for special cases
public interface INotRegisterDependency
{
}</p>
<div class="code"><pre><span></span>## Goals/Features

- [x] [Declarative way of defining lifetime scope](https://github.com/app-enhance/ae-di#how-does-it-work)
- [x] [Retrieval servies from assemblies](https://github.com/app-enhance/ae-di#how-does-it-work)
- [ ] [Repleace dependencies (Decorate)](https://github.com/app-enhance/ae-di#repleace-dependency)
  - [x] Repleace already registered services
  - [x] Repleace dependencies from declarative way
  - [ ] Add wrapper over IServiceCollection to lazy registration
- [ ] [Proxing whole interfaces](https://github.com/app-enhance/ae-di#create-proxy-over-service)
- [ ] [Integrations with popular containers](https://github.com/app-enhance/ae-di#integrations)
  - [ ] [Autofac](https://github.com/app-enhance/ae-di#autofac)
  - [ ] [Ninject](https://github.com/app-enhance/ae-di#ninject)

## How does it work?

In order to use this approach you have to do two things:

* Select dependency interface and inherit

```c#
// It will be registered as a 
// new ServiceDescriptor(typeof(IBankManager), typeof(BankManager), ServiceLifetime.Transient);
public interface IBankManager : ITransientDependency
{
    int OpenAccount(string clientName);
}

public class BankManager : IBankManager
{
    public int OpenAccount(string clientName)
    {
        // Account creating process...

        return Random.Next(1000000, 9999999);
    }
}
</pre></div>


<ul>
<li>Use extensions methods for <code>IServiceCollection</code> or <code>ServiceDescriptorsBuilder</code> to retrieve all dependencies from assemblies (see below)</li>
</ul>
<p>```c#
public void ConfigureServices(IServiceCollection services)
{
    var assemblies = ... Get all assemblies ex. by ILibraryLoader or Assembly.GetExecutingAssembly(...) etc.
    services.AddFromAssemblies(assemblies);</p>
<div class="code"><pre><span></span>// Add MVC services to the services container.
services.AddMvc();
</pre></div>


<p>}</p>
<div class="code"><pre><span></span>There are many custom ways to use service description builder. Most cases described [here](https://github.com/app-enhance/ae-di/wiki/Custom-usage-of-service-descriptions-builder)

### Repleace service
There is possible to override implementaion of service (decorate) which was registered. You can do that by `RepleaceServiceAttribute` (see exapmle below)

```c#
[RepleaceService(typeof(BankManager))]
public class AuditBankManager : BankManager
{
    // Suppose that OpenAccount is virtual
    public override int OpenAccount(string clientName)
    {
        // Do audit...

        var accountNumber = base.OpenAccount(clientName);

        // Do more audit...

        return accountNumber;
    }
}
</pre></div>


<p>Repleace dependency works also with services alredy added to <code>IServiceCollection</code>. TODO: possibility to repleace services added after using this extension.</p>
<p>There is another attibute <code>DecorateServiceAttribute</code> which works the same (inherit of <code>RepleaceServiceAttribute</code>). It is introduced due to semantics and in order to improve code cleanliness.</p>
<h3 id="create-proxy-over-service">Create proxy over service<a class="headerlink" href="#create-proxy-over-service" title="Permanent link">#</a></h3>
<p>(todo)</p>
<h2 id="integrations">Integrations<a class="headerlink" href="#integrations" title="Permanent link">#</a></h2>
<h3 id="autofac">Autofac<a class="headerlink" href="#autofac" title="Permanent link">#</a></h3>
<p>(todo)</p>
<h3 id="ninject">Ninject<a class="headerlink" href="#ninject" title="Permanent link">#</a></h3>
<p>(todo)</p>
<h2 id="contribute">Contribute<a class="headerlink" href="#contribute" title="Permanent link">#</a></h2>
<p>Before pushing new feature or improvement please read <a href="https://github.com/app-enhance/ae-core/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a></p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href=".." title="Home">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Home
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'app-enhance/ae-docs';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>